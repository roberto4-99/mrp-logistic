<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MRP Logistic | Admin</title>
  <link rel="stylesheet" href="/public/app.css"/>

  <style>
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:#fff;
      background:
        radial-gradient(900px 500px at 10% 10%, rgba(99,102,241,.22), transparent 55%),
        radial-gradient(900px 500px at 90% 15%, rgba(59,130,246,.16), transparent 60%),
        radial-gradient(900px 500px at 70% 90%, rgba(34,197,94,.10), transparent 55%),
        linear-gradient(180deg,#071026,#040816);
      min-height:100vh;
      overflow-x:hidden;
    }

    :root{
      --glass: rgba(255,255,255,.07);
      --glass2: rgba(255,255,255,.10);
      --border: rgba(255,255,255,.14);
      --border2: rgba(255,255,255,.20);
      --muted: rgba(255,255,255,.72);
      --muted2: rgba(255,255,255,.60);
      --shadow: 0 26px 80px rgba(0,0,0,.55);
      --shadow2: 0 18px 50px rgba(0,0,0,.38);
      --grad: linear-gradient(135deg,#8b5cf6,#3b82f6);
      --grad2: linear-gradient(135deg,#22c55e,#3b82f6);
      --danger: rgba(239,68,68,.22);
      --dangerb: rgba(239,68,68,.38);
    }

    .toast{
      position:fixed;
      bottom:22px;
      left:50%;
      transform:translateX(-50%);
      background:rgba(2,6,23,.92);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 18px 60px rgba(0,0,0,.55);
      padding:12px 16px;
      border-radius:999px;
      display:none;
      z-index:9999;
      max-width:92vw;
      text-align:center;
      backdrop-filter: blur(12px);
    }
    .toast.show{display:block}

    /* Layout */
    .page{
      max-width:1280px;
      margin:auto;
      padding:18px;
      padding-bottom:110px;
      display:grid;
      grid-template-columns: 280px 1fr;
      gap:14px;
    }
    @media(max-width:980px){
      .page{grid-template-columns:1fr}
    }

    .panel{
      background:var(--glass);
      border:1px solid var(--border);
      border-radius:26px;
      padding:16px;
      box-shadow:var(--shadow2);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }

    /* Sidebar */
    .sideHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:12px;
    }
    .brand{
      display:flex;align-items:center;gap:10px;
      min-width:0;
    }
    .logo{
      width:44px;height:44px;border-radius:16px;
      background:var(--grad2);
      color:#020617;
      font-weight:1000;
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 14px 40px rgba(0,0,0,.35);
      flex:0 0 auto;
      overflow:hidden;
    }
    .btxt{min-width:0}
    .btxt .t{font-weight:1000;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .btxt .s{font-size:12px;color:var(--muted);margin-top:2px}

    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:10px 12px;
      border-radius:999px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      color:#fff;
      font-weight:900;
      font-size:12px;
      white-space:nowrap;
    }

    .navTabs{
      display:grid;
      gap:10px;
      margin-top:10px;
    }
    .tabBtn{
      display:flex;align-items:center;justify-content:space-between;
      gap:10px;
      width:100%;
      padding:12px 12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.08);
      color:#fff;
      cursor:pointer;
      font-weight:1000;
      transition:transform .12s ease, background .2s ease, border-color .2s ease;
    }
    .tabBtn:hover{background:rgba(255,255,255,.12);border-color:rgba(255,255,255,.22);transform:translateY(-1px)}
    .tabBtn:active{transform:translateY(1px)}
    .tabBtn.active{
      background:var(--grad);
      border-color:transparent;
      color:#020617;
      box-shadow:0 14px 38px rgba(59,130,246,.20);
    }
    .tabBtn .left{
      display:flex;align-items:center;gap:10px;min-width:0;
    }
    .tabIco{
      width:38px;height:38px;border-radius:14px;
      display:flex;align-items:center;justify-content:center;
      background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.14);
      font-size:18px;
      flex:0 0 auto;
    }
    .tabBtn.active .tabIco{background:rgba(2,6,23,.12);border-color:rgba(2,6,23,.10)}
    .tabTxt{min-width:0}
    .tabTxt b{display:block}
    .tabTxt span{display:block;font-size:12px;opacity:.85;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:180px}
    .countPill{
      padding:8px 10px;border-radius:999px;
      background:rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.18);
      font-size:12px;font-weight:1000;
      white-space:nowrap;
    }
    .tabBtn.active .countPill{background:rgba(2,6,23,.10);border-color:rgba(2,6,23,.10)}
    .sideActions{
      display:grid;gap:10px;margin-top:12px
    }
    .linkBtn{
      display:inline-flex;align-items:center;justify-content:center;gap:10px;
      padding:12px 14px;border-radius:18px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      color:#fff;text-decoration:none;
      font-weight:1000;
      transition:transform .12s ease, background .2s ease, border-color .2s ease;
    }
    .linkBtn:hover{background:rgba(255,255,255,.12);border-color:rgba(255,255,255,.22);transform:translateY(-1px)}
    .linkBtn:active{transform:translateY(1px)}
    .dangerBtn{
      background:var(--danger);
      border-color:var(--dangerb);
    }
    .dangerBtn:hover{background:rgba(239,68,68,.28);border-color:rgba(239,68,68,.55)}
    .searchBox{
      margin-top:12px;
      padding:12px;
      border-radius:20px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
    }
    .searchBox label{font-size:12px;color:var(--muted);font-weight:900}
    .searchBox input{
      width:100%;
      margin-top:8px;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.35);
      color:#fff;
      outline:none;
      font-size:13px;
    }

    /* Main */
    .mainTop{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin-bottom:12px;
    }
    .mainTop h1{
      margin:0;
      font-size:18px;
      font-weight:1000;
      letter-spacing:.2px;
    }
    .mainTop .small{
      color:var(--muted);
      font-size:12px;
      margin-top:4px;
    }

    .section{
      display:none;
    }
    .section.active{display:block}

    .secHeader{
      display:flex;align-items:flex-start;justify-content:space-between;gap:12px;
      margin-bottom:12px;
    }
    .secHeader .title{
      font-size:16px;
      font-weight:1000;
      margin:0;
    }
    .secHeader .desc{
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
      line-height:1.6;
    }
    .secTools{
      display:flex;gap:10px;align-items:center;flex-wrap:wrap;
      justify-content:flex-end;
    }

    .btnX{
      border:none;cursor:pointer;
      border-radius:999px;
      padding:12px 14px;
      font-weight:1000;
      background:var(--grad);
      color:#020617;
      box-shadow:0 16px 45px rgba(59,130,246,.18);
      transition:transform .12s ease, filter .2s ease;
      white-space:nowrap;
    }
    .btnX:hover{filter:brightness(1.04)}
    .btnX:active{transform:translateY(1px) scale(.99)}
    .btnX.ghost{
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      color:#fff;
      box-shadow:none;
    }
    .btnX.danger{
      background:rgba(239,68,68,.22);
      border:1px solid rgba(239,68,68,.40);
      color:#fff;
      box-shadow:none;
    }

    /* Forms */
    .formGrid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-top:10px;
    }
    @media(max-width:700px){
      .formGrid{grid-template-columns:1fr}
    }
    .field label{font-size:12px;color:var(--muted);font-weight:900}
    .field input, .field select{
      width:100%;
      margin-top:8px;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.35);
      color:#fff;
      outline:none;
      font-size:13px;
    }

    /* Tables */
    .tableWrap{
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.12);
      border-radius:22px;
      overflow:auto;
      box-shadow:0 18px 55px rgba(0,0,0,.22);
    }
    table{
      width:100%;
      border-collapse:collapse;
      min-width:860px;
    }
    th, td{
      padding:12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      vertical-align:top;
      text-align:right;
      font-size:13px;
    }
    thead th{
      position:sticky;
      top:0;
      background:rgba(2,6,23,.88);
      backdrop-filter: blur(10px);
      font-weight:1000;
      z-index:2;
    }
    tbody tr:hover{background:rgba(255,255,255,.04)}
    .muted{color:var(--muted);font-size:12px}
    .tag{
      display:inline-flex;align-items:center;justify-content:center;
      padding:8px 10px;border-radius:999px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      font-weight:1000;
      font-size:12px;
      white-space:nowrap;
    }
    .tag.ok{background:rgba(34,197,94,.14);border-color:rgba(34,197,94,.30)}
    .tag.warn{background:rgba(245,158,11,.14);border-color:rgba(245,158,11,.30)}
    .tag.bad{background:rgba(239,68,68,.14);border-color:rgba(239,68,68,.30)}

    .miniInput{
      width:100%;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.35);
      color:#fff;
      outline:none;
      font-size:13px;
    }
    .rowBtns{
      display:flex;gap:8px;flex-wrap:wrap;
      justify-content:flex-start;
    }

    /* Bottom nav (keep like your app) */
    .nav{
      position:fixed;left:0;right:0;bottom:0;
      background:rgba(0,0,0,.65);
      border-top:1px solid rgba(255,255,255,.14);
      backdrop-filter:blur(12px);
      z-index:999;
    }
    .nav .inner{
      max-width:1280px;margin:auto;
      display:flex;justify-content:space-around;align-items:center;
      padding:10px;
      gap:10px;
    }
    .nav a, .nav button{
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      gap:4px;min-width:90px;
      padding:10px 12px;border-radius:16px;
      color:#fff;text-decoration:none;font-weight:1000;
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.18);
      cursor:pointer;
      user-select:none;
    }
    .nav .ico{font-size:20px;line-height:1}
    .nav .txt{font-size:11px;opacity:.9}
    .nav form{margin:0}

    /* mobile: show sidebar tabs horizontal */
    @media(max-width:980px){
      .sideHeader{margin-bottom:10px}
      .navTabs{
        display:flex;
        overflow:auto;
        gap:10px;
        padding-bottom:6px;
      }
      .tabBtn{min-width:250px}
      .searchBox{display:none}
    }
  </style>
</head>
<body>

  <div class="toast" id="toast"></div>

  <div class="page">

    <!-- SIDEBAR -->
    <aside class="panel">
      <div class="sideHeader">
        <div class="brand">
          <div class="logo">A</div>
          <div class="btxt">
            <div class="t">MRP Logistic</div>
            <div class="s">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± â€” ØªØ­ÙƒÙ… Ø´Ø§Ù…Ù„</div>
          </div>
        </div>
        <div class="chip">ğŸ›¡ï¸ Admin</div>
      </div>

      <div class="navTabs">
        <button class="tabBtn active" id="tab_settings" onclick="openTab('settings')">
          <div class="left">
            <div class="tabIco">âš™ï¸</div>
            <div class="tabTxt">
              <b>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</b>
              <span>ØªØ­ÙˆÙŠÙ„ + Ø­Ø¯ Ø£Ø¯Ù†Ù‰ + ØªÙˆØ§ØµÙ„</span>
            </div>
          </div>
          <div class="countPill">Config</div>
        </button>

        <button class="tabBtn" id="tab_requests" onclick="openTab('requests')">
          <div class="left">
            <div class="tabIco">â³</div>
            <div class="tabTxt">
              <b>Ø·Ù„Ø¨Ø§Øª Pending</b>
              <span>Ù…ÙˆØ§ÙÙ‚Ø©/Ø±ÙØ¶ Ø¨Ø³Ø±Ø¹Ø©</span>
            </div>
          </div>
          <div class="countPill" id="rqCount">0</div>
        </button>

        <button class="tabBtn" id="tab_tasks" onclick="openTab('tasks')">
          <div class="left">
            <div class="tabIco">âœ…</div>
            <div class="tabTxt">
              <b>Ø§Ù„Ù…Ù‡Ø§Ù…</b>
              <span>ØªØ¹Ø¯ÙŠÙ„/Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø·ÙŠÙ„</span>
            </div>
          </div>
          <div class="countPill" id="taskCount">â€”</div>
        </button>

        <button class="tabBtn" id="tab_users" onclick="openTab('users')">
          <div class="left">
            <div class="tabIco">ğŸ‘¤</div>
            <div class="tabTxt">
              <b>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</b>
              <span>Ù†Ù‚Ø§Ø· + ÙƒÙ„Ù…Ø© Ø³Ø±</span>
            </div>
          </div>
          <div class="countPill" id="userCount">â€”</div>
        </button>
      </div>

      <div class="searchBox">
        <label>Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ (Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†/Ø§Ù„Ù…Ù‡Ø§Ù…)</label>
        <input id="globalSearch" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…/ID/Ø¨Ø±ÙŠØ¯/Ø¹Ù†ÙˆØ§Ù† Ù…Ù‡Ù…Ø©..." oninput="applySearch()"/>
      </div>

      <div class="sideActions">
        <a class="linkBtn" href="/home">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a class="linkBtn" href="/tasks">âœ… ØµÙØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</a>
        <form method="post" action="/logout">
          <button type="submit" class="linkBtn dangerBtn" style="width:100%">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </form>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="panel">
      <div class="mainTop">
        <div>
          <h1 id="mainTitle">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>
          <div class="small" id="mainDesc">ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¥ÙŠØ¯Ø§Ø¹/Ø§Ù„Ø³Ø­Ø¨ + ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø¥Ù„Ù‰ Ù†Ù‚Ø§Ø· + ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„.</div>
        </div>
        <div class="chip" id="lastSync">ğŸ”„ Ø¬Ø§Ù‡Ø²</div>
      </div>

      <!-- SETTINGS -->
      <section class="section active" id="sec_settings">
        <div class="secHeader">
          <div>
            <div class="title">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
            <div class="desc">ØºÙŠØ± Ø§Ù„Ù‚ÙŠÙ… Ø«Ù… Ø§Ø¶ØºØ· Ø­ÙØ¸. ÙƒÙ„Ø´ÙŠ ÙƒÙŠÙ…Ø´ÙŠ Ù„Ù†ÙØ³ Endpoints Ø¯ÙŠØ§Ù„ Ø§Ù„Ø³ÙŠØ±ÙØ±.</div>
          </div>
          <div class="secTools">
            <button class="btnX ghost" onclick="loadSettings(); toast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
            <button class="btnX" onclick="saveSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
          </div>
        </div>

        <div class="formGrid">
          <div class="field">
            <label>USD â†’ Points</label>
            <input id="usd_to_points" type="number" min="1" placeholder="Ù…Ø«Ø§Ù„: 10"/>
          </div>
          <div class="field">
            <label>Min Deposit ($)</label>
            <input id="min_deposit_usd" type="number" min="1" placeholder="Ù…Ø«Ø§Ù„: 5"/>
          </div>
          <div class="field">
            <label>Min Withdraw ($)</label>
            <input id="min_withdraw_usd" type="number" min="1" placeholder="Ù…Ø«Ø§Ù„: 10"/>
          </div>
          <div class="field">
            <label>WhatsApp</label>
            <input id="whatsapp" placeholder="+2126xxxxxx"/>
          </div>
          <div class="field">
            <label>Telegram</label>
            <input id="telegram" placeholder="@username"/>
          </div>
          <div class="field">
            <label>Ù…Ù„Ø§Ø­Ø¸Ø©</label>
            <input value="Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ØªØ·Ø¨Ù‚ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©" disabled/>
          </div>
        </div>

        <div style="margin-top:12px;color:var(--muted);font-size:12px;line-height:1.7">
          âœ… Ù†ØµÙŠØ­Ø©: Ø¥Ù„Ø§ Ø¨Ø¯Ù„ØªÙŠ USDâ†’Points Ø®Ù„ÙŠÙ‡ Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù„ÙŠ Ø¹Ù†Ø¯Ùƒ (Ù…Ø«Ù„Ø§Ù‹ 10 Ù†Ù‚Ø§Ø· = 1$).
        </div>
      </section>

      <!-- REQUESTS -->
      <section class="section" id="sec_requests">
        <div class="secHeader">
          <div>
            <div class="title">â³ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹/Ø§Ù„Ø³Ø­Ø¨ (Pending)</div>
            <div class="desc">Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙƒÙŠØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨ØŒ ÙˆØ§Ù†Øª ÙƒØªÙˆØ§ÙÙ‚ ÙˆÙ„Ø§ ÙƒØªØ±ÙØ¶. Ø§Ø³ØªØ¹Ù…Ù„ Refresh Ø¨Ø§Ø´ ØªØ´ÙˆÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯.</div>
          </div>
          <div class="secTools">
            <button class="btnX ghost" onclick="loadRequests()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
            <button class="btnX danger" onclick="loadRequests(); toast('ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª');">âš¡ Refresh Ø³Ø±ÙŠØ¹</button>
          </div>
        </div>

        <div class="tableWrap">
          <table>
            <thead>
              <tr>
                <th>#</th><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>$</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th>
              </tr>
            </thead>
            <tbody id="rq"></tbody>
          </table>
        </div>
      </section>

      <!-- TASKS -->
      <section class="section" id="sec_tasks">
        <div class="secHeader">
          <div>
            <div class="title">âœ… Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…</div>
            <div class="desc">ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© + Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© + Ù…Ø¯Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± + ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù. Ø«Ù… Ø­ÙØ¸ Ù„ÙƒÙ„ Ø³Ø·Ø±.</div>
          </div>
          <div class="secTools">
            <button class="btnX ghost" onclick="loadTasks()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
          </div>
        </div>

        <div class="tableWrap">
          <table>
            <thead>
              <tr>
                <th>#</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Reward</th><th>Wait(s)</th><th>Active</th><th>Ø­ÙØ¸</th>
              </tr>
            </thead>
            <tbody id="tasks"></tbody>
          </table>
        </div>

        <div style="height:14px"></div>

        <div class="secHeader" style="margin-top:10px">
          <div>
            <div class="title">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
            <div class="desc">Ø¹Ø¨Ù‘ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ùˆ Ø¶ØºØ· Ø¥Ø¶Ø§ÙØ©.</div>
          </div>
        </div>

        <div class="formGrid" style="grid-template-columns:2fr 1fr 1fr 1fr">
          <div class="field" style="grid-column:1/2">
            <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©</label>
            <input id="new_title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©"/>
          </div>
          <div class="field">
            <label>Reward</label>
            <input id="new_reward" type="number" min="0" value="15"/>
          </div>
          <div class="field">
            <label>Wait(s)</label>
            <input id="new_wait" type="number" min="1" value="10"/>
          </div>
          <div class="field" style="display:flex;align-items:end">
            <button class="btnX" style="width:100%" onclick="createTask()">Ø¥Ø¶Ø§ÙØ©</button>
          </div>
        </div>
      </section>

      <!-- USERS -->
      <section class="section" id="sec_users">
        <div class="secHeader">
          <div>
            <div class="title">ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</div>
            <div class="desc">ØªØºÙŠÙŠØ± Ø§Ù„Ù†Ù‚Ø§Ø· + Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³ØªØ¹Ù…Ù„ Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø±.</div>
          </div>
          <div class="secTools">
            <button class="btnX ghost" onclick="loadUsers()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
          </div>
        </div>

        <div class="tableWrap">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>ØªÙˆØ§ØµÙ„</th>
                <th>Ù†Ù‚Ø§Ø·</th>
                <th>ÙƒÙ„Ù…Ø© Ø³Ø± Ø¬Ø¯ÙŠØ¯Ø©</th>
                <th>Ø­ÙØ¸</th>
              </tr>
            </thead>
            <tbody id="us"></tbody>
          </table>
        </div>
      </section>

    </main>
  </div>

  <!-- bottom nav -->
  <div class="nav">
    <div class="inner">
      <a href="/home"><span class="ico">ğŸ </span><span class="txt">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></a>
      <a href="/tasks"><span class="ico">âœ…</span><span class="txt">Ø§Ù„Ù…Ù‡Ø§Ù…</span></a>
      <a href="/profile"><span class="ico">ğŸ‘¤</span><span class="txt">Ø¨Ø±ÙˆÙØ§ÙŠÙ„</span></a>
      <form method="post" action="/logout">
        <button type="submit"><span class="ico">ğŸšª</span><span class="txt">Ø®Ø±ÙˆØ¬</span></button>
      </form>
    </div>
  </div>

  <script src="/public/app.js"></script>
  <script>
    function setSync(txt){ const el=document.getElementById("lastSync"); if(el) el.textContent=txt; }

    function toast(msg){
      const t=document.getElementById("toast");
      t.textContent=msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"),2600);
    }

    function typeLabel(t){ return t==="deposit" ? "Ø¥ÙŠØ¯Ø§Ø¹" : "Ø³Ø­Ø¨"; }
    function statusTag(s){
      const v = String(s||"").toLowerCase();
      if(v.includes("approved")) return '<span class="tag ok">Approved</span>';
      if(v.includes("rejected")) return '<span class="tag bad">Rejected</span>';
      return '<span class="tag warn">Pending</span>';
    }

    function openTab(key){
      // buttons
      const keys=["settings","requests","tasks","users"];
      for(const k of keys){
        document.getElementById("tab_"+k)?.classList.remove("active");
        document.getElementById("sec_"+k)?.classList.remove("active");
      }
      document.getElementById("tab_"+key)?.classList.add("active");
      document.getElementById("sec_"+key)?.classList.add("active");

      // title/desc
      const mainTitle = document.getElementById("mainTitle");
      const mainDesc  = document.getElementById("mainDesc");
      const map = {
        settings:{t:"Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", d:"ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„ + Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ + ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„."},
        requests:{t:"Ø·Ù„Ø¨Ø§Øª Pending", d:"Ù…ÙˆØ§ÙÙ‚Ø© Ø£Ùˆ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¨Ø³Ø±Ø¹Ø©."},
        tasks:{t:"Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…", d:"ØªØ¹Ø¯ÙŠÙ„/Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ø³ÙŠØ±ÙØ±."},
        users:{t:"Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†", d:"ØªØºÙŠÙŠØ± Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±."},
      };
      if(mainTitle) mainTitle.textContent = map[key].t;
      if(mainDesc)  mainDesc.textContent  = map[key].d;
    }

    // -------- SETTINGS ----------
    async function loadSettings(){
      setSync("ğŸ”„ ØªØ­Ù…ÙŠÙ„...");
      const r = await api("/api/admin/settings");
      const s = r.settings;
      document.getElementById("usd_to_points").value = s.usd_to_points;
      document.getElementById("min_deposit_usd").value = s.min_deposit_usd;
      document.getElementById("min_withdraw_usd").value = s.min_withdraw_usd;
      document.getElementById("whatsapp").value = s.manager_contact?.whatsapp || "";
      document.getElementById("telegram").value = s.manager_contact?.telegram || "";
      setSync("âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«");
    }

    async function saveSettings(){
      try{
        setSync("ğŸ’¾ Ø­ÙØ¸...");
        await api("/api/admin/settings","POST",{
          usd_to_points: document.getElementById("usd_to_points").value,
          min_deposit_usd: document.getElementById("min_deposit_usd").value,
          min_withdraw_usd: document.getElementById("min_withdraw_usd").value,
          whatsapp: document.getElementById("whatsapp").value,
          telegram: document.getElementById("telegram").value
        });
        toast("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âœ…");
        setSync("âœ… Ù…Ø­ÙÙˆØ¸");
      }catch(e){
        toast(e.message);
        setSync("âš ï¸ Ø®Ø·Ø£");
      }
    }

    // -------- REQUESTS ----------
    async function loadRequests(){
      setSync("ğŸ”„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...");
      const reqs = await api("/api/admin/requests");
      const rq = document.getElementById("rq");
      rq.innerHTML = "";

      document.getElementById("rqCount").textContent = (reqs.rows||[]).length;

      for(const r of (reqs.rows||[])){
        rq.innerHTML += `
          <tr data-row="rq">
            <td>${r.id}</td>
            <td>
              <b>${r.full_name || "-"}</b>
              <div class="muted">${(r.email || r.phone || "")}</div>
            </td>
            <td><span class="tag">${typeLabel(r.type)}</span></td>
            <td>${formatUsd(r.amount_usd)}</td>
            <td><b>${r.points_delta}</b></td>
            <td>${statusTag(r.status || "pending")}</td>
            <td>
              <div class="rowBtns">
                <button class="btnX ghost" onclick="approve('${r.id}')">âœ… Ù…ÙˆØ§ÙÙ‚Ø©</button>
                <button class="btnX danger" onclick="reject('${r.id}')">â›” Ø±ÙØ¶</button>
              </div>
            </td>
          </tr>
        `;
      }
      if((reqs.rows||[]).length===0){
        rq.innerHTML = `<tr><td colspan="7" class="muted" style="padding:16px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Pending.</td></tr>`;
      }
      setSync("âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«");
    }

    async function approve(id){
      try{
        await api(`/api/admin/requests/${id}/approve`,"POST",{});
        toast("ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© âœ…");
        loadRequests();
      }catch(e){ toast(e.message); }
    }
    async function reject(id){
      try{
        await api(`/api/admin/requests/${id}/reject`,"POST",{});
        toast("ØªÙ… Ø§Ù„Ø±ÙØ¶ âœ…");
        loadRequests();
      }catch(e){ toast(e.message); }
    }

    // -------- TASKS ----------
    let CACHE_TASKS = [];
    async function loadTasks(){
      setSync("ğŸ”„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…...");
      const r = await api("/api/admin/tasks");
      CACHE_TASKS = r.rows || [];
      document.getElementById("taskCount").textContent = CACHE_TASKS.length || 0;

      const tb = document.getElementById("tasks");
      tb.innerHTML = "";
      for(const t of CACHE_TASKS){
        tb.innerHTML += `
          <tr data-row="task" data-search="${escapeHtml((t.title||"")+" "+t.id+" "+t.order_index)}">
            <td><b>${t.order_index}</b></td>
            <td><input class="miniInput" id="t_title_${t.id}" value="${escapeAttr(t.title)}"/></td>
            <td><input class="miniInput" type="number" min="0" id="t_reward_${t.id}" value="${t.reward_points}"/></td>
            <td><input class="miniInput" type="number" min="1" id="t_wait_${t.id}" value="${t.wait_seconds}"/></td>
            <td>
              <select class="miniInput" id="t_active_${t.id}">
                <option value="true" ${t.is_active ? "selected":""}>Yes</option>
                <option value="false" ${!t.is_active ? "selected":""}>No</option>
              </select>
            </td>
            <td>
              <button class="btnX ghost" onclick="saveTask(${t.id})">ğŸ’¾ Ø­ÙØ¸</button>
            </td>
          </tr>
        `;
      }
      setSync("âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«");
      applySearch();
    }

    async function saveTask(id){
      try{
        await api(`/api/admin/tasks/${id}/update`,"POST",{
          title: document.getElementById(`t_title_${id}`).value,
          reward_points: document.getElementById(`t_reward_${id}`).value,
          wait_seconds: document.getElementById(`t_wait_${id}`).value,
          is_active: document.getElementById(`t_active_${id}`).value === "true"
        });
        toast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø© âœ…");
        loadTasks();
      }catch(e){ toast(e.message); }
    }

    async function createTask(){
      try{
        await api("/api/admin/tasks/create","POST",{
          title: document.getElementById("new_title").value,
          reward_points: document.getElementById("new_reward").value,
          wait_seconds: document.getElementById("new_wait").value
        });
        toast("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© âœ…");
        document.getElementById("new_title").value = "";
        loadTasks();
      }catch(e){ toast(e.message); }
    }

    // -------- USERS ----------
    let CACHE_USERS = [];
    async function loadUsers(){
      setSync("ğŸ”„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...");
      const users = await api("/api/admin/users");
      CACHE_USERS = users.rows || [];
      document.getElementById("userCount").textContent = CACHE_USERS.length || 0;

      const us = document.getElementById("us");
      us.innerHTML = "";
      for(const u of CACHE_USERS){
        const contact = u.email || u.phone || "-";
        us.innerHTML += `
          <tr data-row="user" data-search="${escapeHtml((u.full_name||"")+" "+(u.id||"")+" "+contact)}">
            <td><b>${u.id}</b></td>
            <td>${escapeHtml(u.full_name || "-")}</td>
            <td class="muted">${escapeHtml(contact)}</td>
            <td><input class="miniInput" style="max-width:140px" id="p_${u.id}" value="${u.points_balance}"/></td>
            <td><input class="miniInput" style="max-width:180px" id="pw_${u.id}" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ø¬Ø¯ÙŠØ¯Ø©"/></td>
            <td>
              <div class="rowBtns">
                <button class="btnX ghost" onclick="setPoints('${u.id}')">ğŸ’  Ù†Ù‚Ø§Ø·</button>
                <button class="btnX" onclick="setPassword('${u.id}')">ğŸ”’ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</button>
              </div>
            </td>
          </tr>
        `;
      }
      setSync("âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«");
      applySearch();
    }

    async function setPoints(userId){
      try{
        await api(`/api/admin/users/${userId}/points`,"POST",{
          points: document.getElementById(`p_${userId}`).value
        });
        toast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· âœ…");
        loadUsers();
      }catch(e){ toast(e.message); }
    }

    async function setPassword(userId){
      try{
        const new_password = document.getElementById(`pw_${userId}`).value;
        if(!new_password || new_password.length < 6){
          toast("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
          return;
        }
        await api(`/api/admin/users/${userId}/password`,"POST",{ new_password });
        document.getElementById(`pw_${userId}`).value = "";
        toast("ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± âœ…");
      }catch(e){ toast(e.message); }
    }

    // -------- SEARCH (front-end only) ----------
    function applySearch(){
      const q = (document.getElementById("globalSearch")?.value || "").trim().toLowerCase();
      const rows = document.querySelectorAll('tr[data-search]');
      for(const r of rows){
        const hay = (r.getAttribute("data-search")||"").toLowerCase();
        r.style.display = (!q || hay.includes(q)) ? "" : "none";
      }
    }

    // -------- Helpers ----------
    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[m]));
    }
    function escapeAttr(s){ return escapeHtml(s).replace(/"/g,"&quot;"); }

    // -------- INIT ----------
    async function init(){
      openTab("settings");
      await loadSettings();
      await loadRequests();
      await loadTasks();
      await loadUsers();
    }
    init().catch(e=>toast(e.message));
  </script>
</body>
</html>